<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basic Location Search - SafeWay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700">
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>

    <style>
/* ğŸŒ Base Styles */
/* ğŸŒ Base Styles */
body {
  background: linear-gradient(135deg, #e0f0ff 0%, #ffffff 100%);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #223344;
}

/* â¬› Navbar Styles */
.main-header.navbar {
  background: #004085;
  color: white;
  font-weight: 600;
  box-shadow: 0 3px 8px rgba(0, 64, 133, 0.3);
}

.main-header.navbar .nav-link,
.main-header.navbar .nav-icon {
  color: #cce0ff;
  transition: color 0.3s ease;
}

.main-header.navbar .nav-link:hover {
  color: #ffffff;
}

/* ğŸ§­ Sidebar Styles */
.main-sidebar {
  background-color: rgb(28, 31, 34);
  color: #ffffff;
}

.main-sidebar .brand-link {
  background-color: rgb(34, 38, 43);
  color: #ffffff;
  font-weight: bold;
  border-bottom: 1px solid #003366;
}

.main-sidebar .nav-link {
  color: #cfd9ff;
  font-weight: 500;
  transition: all 0.3s ease;
}

.main-sidebar .nav-link .nav-icon {
  color: #a0b8ff;
}

.main-sidebar .nav-link.active,
.main-sidebar .nav-link:hover {
  background-color: #e6f0ff;
  color: #001f3f;
  font-weight: bold;
  border-radius: 8px;
}

.main-sidebar .nav-link.active .nav-icon,
.main-sidebar .nav-link:hover .nav-icon {
  color: #001f3f;
}

/* ğŸ“„ Content Wrapper */
.content-wrapper {
  background: #fdfefe;
  padding: 40px 35px 60px;
  min-height: calc(100vh - 56px);
}

/* ğŸ“¢ Headings (h2 and card titles) */
h2,
h3.card-title {
  border-bottom: 4px solid #0056b3;
  padding-bottom: 12px;
  margin-bottom: 30px;
  font-weight: 800;
  color: #003366;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

/* ğŸ“¦ Card Styles */
.card.card-info {
  border-radius: 15px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
  border: none;
}

/* Card header with custom style */
/* Card header with custom style */
.card.card-info .card-header {
  background-color: #005db9ff; /* Deep but slightly lighter than h2 text */
  border-radius: 15px 15px 0 0;
  color: white;
}


/* Custom header class for enhanced styling */
.card-header.custom-header {
  background-color: #004085; /* same dark blue theme */
  color: #ffffff;            /* white text for contrast */
  font-weight: 700;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  gap: 10px;                 /* spacing between emoji and text */
  border-radius: 15px 15px 0 0;
  border-bottom: none;
  text-decoration: none;     /* remove underline */
  padding: 15px 25px;
  box-shadow: 0 4px 8px rgba(0, 64, 133, 0.3);
}

/* Card title inside the custom header */
.card-header.custom-header h3.card-title {
  margin: 0;                /* remove default margin */
  text-decoration: none;    /* ensure no underline */
  font-size: 1.4rem;
  font-weight: 700;
  color: #ffffff;
  display: flex;
  align-items: center;
  gap: 10px;
  letter-spacing: 0.5px;
}


.custom-header {
  background: linear-gradient(135deg,rgb(1, 30, 73),rgb(143, 179, 214));
  border-radius: 15px 15px 0 0;
  padding: 20px 25px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}

/* ğŸ” Input Group (search box) */
.search-box input.form-control {
  border-radius: 10px 0 0 10px;
  border: 2px solid #0056b3;
  padding: 12px 15px;
  font-size: 1rem;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06);
  transition: 0.3s;
}

.search-box input.form-control:focus {
  border-color: #00254d;
  box-shadow: 0 0 10px #0056b3aa;
}

.search-box .btn.btn-info {
  background-color: #004085;
  border-color: #004085;
  border-radius: 0 10px 10px 0;
  font-weight: bold;
  transition: 0.3s;
}

.search-box .btn.btn-info:hover {
  background-color: #00254d;
}

/* ğŸ—ºï¸ Map Styling */
#map {
  height: 450px;
  border-radius: 15px;
  border: 3px solid #004085;
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
  transition: box-shadow 0.3s ease;
}

#map:hover {
  box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
}

/* ğŸ§¾ Info Cards */
.info-card .info-box {
  background: #ffffff;
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s;
}

.info-card .info-box:hover {
  transform: translateY(-3px);
}

.info-card h5 {
  font-weight: 700;
  color: #004085;
  margin-bottom: 10px;
  font-size: 1rem;
}

/* Highlighted text styling */
.highlight {
  color: #17a2b8;
  font-weight: bold;
}

/* List styles */
ul {
  padding-left: 1.2rem;
}

ul li {
  margin-bottom: 6px;
  color: #333;
}

/* ğŸªŸ Responsive adjustments */
@media (max-width: 768px) {
  .search-box input.form-control,
  .search-box .btn.btn-info {
    width: 100%;
    border-radius: 10px !important;
    margin-top: 10px;
  }

  .info-card {
    margin-bottom: 20px;
  }
}


</style>

</head>




<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="dashboard.html" class="nav-link">Home</a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
  <a href="dashboard.html" class="brand-link">
    <img src="dist/img/AdminLTELogo.png" alt="Logo" class="brand-image img-circle elevation-3">
    <span class="brand-text font-weight-light">SafeWay</span>
  </a>
  <div class="sidebar">
    <nav class="mt-2">
      <ul class="nav nav-pills nav-sidebar flex-column" role="menu">
        <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="nav-icon fas fa-tachometer-alt"></i><p>Dashboard</p></a></li>
        <li class="nav-item"><a href="location_search.html" class="nav-link active"><i class="nav-icon fas fa-shield-alt"></i><p>Safety Control Center</p></a></li>
        <li class="nav-item"><a href="safety_unified.html" class="nav-link"><i class="nav-icon fas fa-map-marked-alt"></i><p>Unified Safety Explorer</p></a></li>
        <li class="nav-item"><a href="identify_routes.html" class="nav-link"><i class="nav-icon fas fa-route"></i><p>Identify Safer Routes</p></a></li>
        <li class="nav-item"><a href="filter_incidents.html" class="nav-link"><i class="nav-icon fas fa-exclamation-triangle"></i><p>Incidents & Hotspots</p></a></li>
        <li class="nav-item"><a href="community_resources.html" class="nav-link"><i class="nav-icon fas fa-hands-helping"></i><p>Community Resources</p></a></li>
        <li class="nav-item"><a href="legend_info.php" class="nav-link "><i class="nav-icon fas fa-map"></i><p>Using the Legend</p></a></li>
        <li class="nav-item"><a href="send_notifications.html" class="nav-link"><i class="nav-icon fas fa-bell"></i><p>Send Notifications</p></a></li>
        <li class="nav-item"><a href="all_notifications.html" class="nav-link"><i class="nav-icon fas fa-bell"></i><p>All Notifications</p></a></li>
        <li class="nav-item"><a href="emergency_calls.html" class="nav-link"><i class="nav-icon fas fa-phone-alt"></i><p>Emergency Calls</p></a></li>
        <li class="nav-item"><a href="login.html" class="nav-link"><i class="nav-icon fas fa-sign-out-alt"></i><p>Logout</p></a></li>
      </ul>
    </nav>
  </div>
</aside>


<!-- Main Content -->
<div class="content-wrapper p-3">
  <div class="container-fluid">
    <!-- Header -->
    <header class="text-center py-3 mb-4">
      <h3 class="mb-1">ğŸ” Safety Check â€¢ Locate â€¢ Navigate â€¢ Insights</h3>
      <div id="liveClock" class="mt-1 small text-muted"></div>
    </header>

    <!-- Search + Actions -->
    <div class="card card-info">
      <div class="card-header">
        <h3 class="card-title">ğŸ“ Search for a Location in Dhaka</h3>
      </div>
      <div class="card-body">
        <form id="location-form">
          <div class="input-group">
            <input type="text" id="locationInput" class="form-control" placeholder="e.g., Dhanmondi, Dhaka">
            <div class="input-group-append">
              <button type="submit" class="btn btn-info">Search</button>
            </div>
          </div>
        </form>

        <div class="mt-3 d-flex flex-wrap gap-2">
          <button id="copySummaryBtn" class="btn btn-outline-secondary btn-sm">Copy Summary</button>
          <div id="timeAdvisoryChip" class="badge badge-secondary p-2 ml-2">Time Advisory</div>
          <div id="lightingChip" class="badge badge-secondary p-2 ml-2">Lighting</div>
        </div>

        <div id="map" class="mt-3" style="height: 520px;"></div>
      </div>
    </div>

    <!-- Quick KPIs -->
    <div class="row mt-3">
      <div class="col-md-4">
        <div class="info-box bg-success">
          <span class="info-box-icon"><i class="fas fa-shield-alt"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Safety Score</span>
            <span id="safetyScoreText" class="info-box-number">â€”</span>
            <div class="progress"><div id="safetyScoreBar" class="progress-bar" style="width: 0%"></div></div>
            <span id="crimeTrendText" class="progress-description">Crime Trend: â€”</span>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="info-box bg-info">
          <span class="info-box-icon"><i class="fas fa-cloud-sun-rain"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Weather Advisory</span>
            <span id="weatherAdvisory" class="info-box-number">â€”</span>
            <div class="progress"><div class="progress-bar" style="width: 100%"></div></div>
            <span id="clothingTip" class="progress-description">Clothing Tip: â€”</span>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="info-box bg-warning">
          <span class="info-box-icon"><i class="fas fa-users"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Crowd & Noise</span>
            <span id="crowdDensity" class="info-box-number">â€”</span>
            <div class="progress"><div class="progress-bar" style="width: 100%"></div></div>
            <span id="noiseLevel" class="progress-description">Noise: â€”</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Details -->
    <div class="row">
      <div class="col-md-6">
        <div class="card"><div class="card-header"><h3 class="card-title">ğŸ¥ Nearby Hospitals</h3></div><div class="card-body"><ul id="hospitalList"></ul></div></div>
      </div>
      <div class="col-md-6">
        <div class="card"><div class="card-header"><h3 class="card-title">ğŸ‘® Nearby Police Stations</h3></div><div class="card-body"><ul id="policeList"></ul></div></div>
      </div>
      <div class="col-md-6">
        <div class="card"><div class="card-header"><h3 class="card-title">ğŸ“ˆ Crime Trends</h3></div><div class="card-body"><p id="crimeTrendPara">â€”</p></div></div>
      </div>
      <div class="col-md-6">
        <div class="card"><div class="card-header"><h3 class="card-title">ğŸ“ Emergency Contacts</h3></div>
          <div class="card-body">
            <ul>
              <li>Police: <strong>999</strong></li>
              <li>Womenâ€™s Helpline: <strong>109</strong></li>
              <li>Fire Service: <strong>199</strong></li>
              <li>Health Help: <strong>16263</strong></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6"><div class="card"><div class="card-header"><h3 class="card-title">ğŸ›¡ï¸ Safety Tips</h3></div><div class="card-body"><ul id="safetyTips"><li>Avoid dark alleys after 8 PM.</li><li>Stay in well-lit areas.</li></ul></div></div></div>
      <div class="col-md-6"><div class="card"><div class="card-header"><h3 class="card-title">ğŸš‰ Transport Safety</h3></div><div class="card-body" id="transportScores">â€”</div></div></div>
      <div class="col-md-12"><div class="card"><div class="card-header"><h3 class="card-title">ğŸš¨ Last Reported Incidents</h3></div><div class="card-body"><ul id="incidentList"></ul></div></div></div>
      <div class="col-md-12"><div class="card"><div class="card-header"><h3 class="card-title">ğŸŒ¤ï¸ Mood Forecast</h3></div><div class="card-body"><div id="moodForecast">Analyzingâ€¦</div></div></div></div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="plugins/jquery/jquery.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="dist/js/adminlte.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>
// === Sample Data in localStorage ===
if (!localStorage.getItem("location_safety")) {
  localStorage.setItem("location_safety", JSON.stringify([
    {
      area_name: "Dhanmondi",
      lat: 23.7465, lon: 90.3760,
      safety_score: 78,
      hospitals: "Labaid Hospital, Ibn Sina Hospital",
      police_stations: "Dhanmondi PS, Kalabagan PS",
      crime_trend: "Decreasing theft incidents",
      weather_advisory: "Sunny with light breeze",
      crowd_density: "High",
      incidents: "Pickpocketing, Traffic jam",
      transport_scores: { Bus: 60, Rickshaw: 70, Uber: 85 }
    },
    {
      area_name: "Gulshan",
      lat: 23.7925, lon: 90.4078,
      safety_score: 88,
      hospitals: "United Hospital, Gulshan Clinic",
      police_stations: "Gulshan PS, Banani PS",
      crime_trend: "Stable, occasional traffic issues",
      weather_advisory: "Cloudy, chance of rain",
      crowd_density: "Moderate",
      incidents: "Traffic accidents",
      transport_scores: { Bus: 50, CNG: 75, Uber: 90 }
    }
  ]));
}

function getSafetyFromLocal(location) {
  const data = JSON.parse(localStorage.getItem("location_safety")) || [];
  return data.find(item => item.area_name.toLowerCase() === location.toLowerCase()) || null;
}

// === Existing UI + Map Logic ===
const map = L.map('map').setView([23.8103, 90.4125], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let currentMarker, radiusCircle;
function putMarker(lat, lon, label) {
  if (currentMarker) map.removeLayer(currentMarker);
  if (radiusCircle) map.removeLayer(radiusCircle);
  currentMarker = L.marker([lat, lon]).addTo(map).bindPopup(label).openPopup();
  radiusCircle = L.circle([lat, lon], { radius: 400, fillOpacity: 0.08 }).addTo(map);
  map.setView([lat, lon], 15);
}

// Clock
setInterval(() => {
  document.getElementById('liveClock').textContent = "ğŸ•’ " + new Date().toLocaleTimeString();
}, 1000);

// UI helpers
function setSafetyScore(score, trend) {
  document.getElementById("safetyScoreText").textContent = score + "/100";
  document.getElementById("safetyScoreBar").style.width = score + "%";
  document.getElementById("crimeTrendText").textContent = "Crime Trend: " + (trend || "â€”");
}
function renderCSVList(el, csv) {
  el.innerHTML = "";
  (csv||"").split(",").forEach(x => { if (x.trim()) { const li=document.createElement("li"); li.textContent=x.trim(); el.appendChild(li); } });
}
function renderTransportScores(div, obj) {
  div.innerHTML = "";
  Object.entries(obj||{}).forEach(([k,v])=>{
    const span=document.createElement("span");
    span.className="badge badge-pill mr-2 " + (v>70?"badge-success":v>40?"badge-warning":"badge-danger");
    span.textContent=`${k}: ${v}`;
    div.appendChild(span);
  });
}
function moodForecast(score){
  document.getElementById("moodForecast").textContent = score>80?"Positive vibes ğŸŒ":score>50?"Mixed vibes ğŸŒ¤ï¸":"Caution vibes ğŸŒ§ï¸";
}

// Search
async function doSearch(location) {
  const record = getSafetyFromLocal(location);
  if (!record) { alert("No local data found for "+location); return; }
  putMarker(record.lat, record.lon, record.area_name);
  setSafetyScore(record.safety_score, record.crime_trend);
  document.getElementById("crimeTrendPara").textContent=record.crime_trend;
  document.getElementById("weatherAdvisory").textContent=record.weather_advisory;
  document.getElementById("crowdDensity").textContent=record.crowd_density;
  renderCSVList(document.getElementById("hospitalList"), record.hospitals);
  renderCSVList(document.getElementById("policeList"), record.police_stations);
  renderCSVList(document.getElementById("incidentList"), record.incidents);
  renderTransportScores(document.getElementById("transportScores"), record.transport_scores);
  moodForecast(record.safety_score);
  window.__lastAreaName = record.area_name;
}

document.getElementById("location-form").addEventListener("submit", e=>{
  e.preventDefault();
  const q=document.getElementById("locationInput").value.trim();
  if(q) doSearch(q);
});

// Copy summary
document.getElementById("copySummaryBtn").addEventListener("click",()=>{
  const area=window.__lastAreaName||"(Unknown)";
  const score=document.getElementById("safetyScoreText").textContent;
  const weather=document.getElementById("weatherAdvisory").textContent;
  const crowd=document.getElementById("crowdDensity").textContent;
  navigator.clipboard.writeText(`Area: ${area}\nScore: ${score}\nWeather: ${weather}\nCrowd: ${crowd}`);
  alert("Summary copied!");
});
</script>
</body>
</html>