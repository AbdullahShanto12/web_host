<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìä SafeWay Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Styles -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css" />
  <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css" />
  <link rel="stylesheet" href="dist/css/adminlte.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />

  <style>
    body { font-family: 'Source Sans Pro', sans-serif; background: #f8f9fa; }
    .insight-section { margin-bottom: 30px; }
    .table-responsive { overflow-x: auto; }
    .dataTables_wrapper .dt-buttons {
      margin-bottom: 10px;
    }
    .card h4 i { margin-right: 10px; }
    .badge { font-size: 0.95rem; padding: 0.4em 0.6em; }
    .data-table th, .data-table td { vertical-align: middle; }
    .card-header {
      border-bottom: 2px solid rgba(0,0,0,0.1);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.1);
    }
    .insight-section .card-body {
      background-color: #ffffff;
    }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a></li>
      <li class="nav-item d-none d-sm-inline-block"><a href="dashboard.html" class="nav-link">Home</a></li>
    </ul>
  </nav>

  <!-- Sidebar -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <a href="dashboard.php" class="brand-link">
      <img src="dist/img/AdminLTELogo.png" alt="SafeWay Logo" class="brand-image img-circle elevation-3" />
      <span class="brand-text font-weight-light">SafeWay</span>
    </a>
    <div class="sidebar">
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column">
          <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="nav-icon fas fa-chart-bar"></i><p>Dashboard</p></a></li>
          <li class="nav-item"><a href="detailed_Insights.html" class="nav-link active"><i class="nav-icon fas fa-table"></i><p>Detailed Insights</p></a></li>
        </ul>
      </nav>
    </div>
  </aside>

  <!-- Content -->
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <h2 class="mb-1">üîç SafeWay Insights</h2>
        <p class="text-muted">Live analysis pulled from 8 key SafeWay datasets</p>
      </div>
    </section>

    <section class="content">
      <div class="container-fluid">

        <!-- Crime Hotspots (Top 4) -->
        <div class="card insight-section">
          <div class="card-header bg-danger text-white">
            <h4><i class="fas fa-map-marked-alt"></i> Crime Hotspots (Top 4)</h4>
          </div>
          <div class="card-body">
            <div class="row" id="crimeHotspotsContainer"></div>
          </div>
        </div>

        <!-- Safety Distribution -->
        <div class="card insight-section">
          <div class="card-header bg-success text-white"><h4><i class="fas fa-chart-pie"></i> Safety Distribution</h4></div>
          <div class="card-body row" id="safetyDistributionContainer"></div>
        </div>

        <!-- Safety Checks Table -->
        <div class="card insight-section">
          <div class="card-header bg-info text-white"><h4><i class="fas fa-check-circle"></i> Safety Check Usage</h4></div>
          <div class="card-body table-responsive">
            <table id="safetyChecksTable" class="table table-bordered table-hover">
              <thead class="thead-dark"><tr><th>Day</th><th>Time</th><th>Type</th><th>Location</th><th>Status</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Feature Usage Table -->
        <div class="card insight-section">
          <div class="card-header bg-primary text-white"><h4><i class="fas fa-cogs"></i> Feature Usage</h4></div>
          <div class="card-body table-responsive">
            <table id="featureUsageTable" class="table table-bordered table-hover">
              <thead class="thead-dark"><tr><th>Feature</th><th>Usage Count</th><th>User Type</th><th>Last Used</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Weekly Crime Type Trends Table -->
        <div class="card insight-section">
          <div class="card-header bg-warning text-dark"><h4><i class="fas fa-chart-line"></i> Weekly Crime Type Trends</h4></div>
          <div class="card-body table-responsive">
            <table id="crimeTrendsTable" class="table table-striped table-sm table-hover">
              <thead class="thead-dark"><tr><th>Week</th><th>Area</th><th>Theft</th><th>Harassment</th><th>Assault</th><th>Robbery</th><th>Vandalism</th><th>Kidnapping</th><th>Last Update</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Emergency Response Table -->
        <div class="card insight-section">
          <div class="card-header bg-secondary text-white"><h4><i class="fas fa-ambulance"></i> Emergency Response</h4></div>
          <div class="card-body table-responsive">
            <table id="emergencyResponseTable" class="table table-striped table-hover">
              <thead class="thead-dark"><tr><th>Area</th><th>Service Type</th><th>Avg. Response Time (min)</th><th>Rating</th><th>Last Reported</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Notification Engagement Table -->
        <div class="card insight-section">
          <div class="card-header bg-teal text-white"><h4><i class="fas fa-bell"></i> Notification Engagement</h4></div>
          <div class="card-body table-responsive">
            <table id="notificationTable" class="table table-sm table-bordered table-hover">
              <thead class="thead-dark"><tr><th>Type</th><th>Location</th><th>Viewed</th><th>Clicked</th><th>Dismissed</th><th>Sent At</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Feedback Bubble Table -->
        <div class="card insight-section">
          <div class="card-header bg-purple text-white"><h4><i class="fas fa-comments"></i> User Feedback & Traffic</h4></div>
          <div class="card-body table-responsive">
            <table id="feedbackTable" class="table table-striped table-hover">
              <thead class="thead-dark"><tr><th>Label</th><th>Positive</th><th>Negative</th><th>Safety Score</th><th>Traffic</th><th>Submitted At</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </div>
    </section>
  </div>
</div>

<!-- jQuery (must be before DataTables) -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<!-- DataTables JS & Buttons -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>

<script>
  // Sample Data: replace with your actual data
  const crimeHotspots = [
    { area: "Dhanmondi", thana: "Dhanmondi", incident_count: 123, crime_index: 76.5 },
    { area: "Gulshan", thana: "Gulshan", incident_count: 110, crime_index: 65.3 },
    { area: "Mirpur", thana: "Mirpur", incident_count: 98, crime_index: 55.8 },
    { area: "Motijheel", thana: "Motijheel", incident_count: 87, crime_index: 47.1 }
  ];

  const safetyDistribution = [
    { category: "Zone A", label: "Safe", value: 70, weightage_percent: 45 },
    { category: "Zone B", label: "Moderate", value: 50, weightage_percent: 35 },
    { category: "Zone C", label: "Unsafe", value: 30, weightage_percent: 20 }
  ];

  const safetyChecks = [
    { check_day: "Monday", check_time: "10:00", check_type: "Manual", location: "Dhanmondi", status: "Safe" },
    { check_day: "Tuesday", check_time: "11:30", check_type: "Auto", location: "Gulshan", status: "Unsafe" },
    { check_day: "Wednesday", check_time: "09:15", check_type: "Manual", location: "Mirpur", status: "Safe" },
    { check_day: "Thursday", check_time: "14:00", check_type: "Auto", location: "Motijheel", status: "Safe" }
  ];

  const featureUsage = [
    { feature: "Map Exploration", usage_count: 345, user_type: "Registered", last_used_at: "2025-07-17" },
    { feature: "Safety Check", usage_count: 289, user_type: "Guest", last_used_at: "2025-07-16" }
  ];

  const crimeTypeTrends = [
    { week: "2025-W28", area: "Dhanmondi", theft: 12, harassment: 5, assault: 3, robbery: 2, vandalism: 1, kidnapping: 0, updated_at: "2025-07-15" },
    { week: "2025-W28", area: "Gulshan", theft: 8, harassment: 3, assault: 1, robbery: 0, vandalism: 2, kidnapping: 1, updated_at: "2025-07-15" }
  ];

  const emergencyResponse = [
    { area: "Dhanmondi", service_type: "Ambulance", average_response_time_min: 7.5, response_rating: 4.2, last_reported: "2025-07-16" },
    { area: "Gulshan", service_type: "Fire Service", average_response_time_min: 6.8, response_rating: 4.5, last_reported: "2025-07-16" }
  ];

  const notificationEngagement = [
    { type: "Alert", location: "Dhanmondi", viewed: 100, clicked: 50, dismissed: 10, sent_at: "2025-07-15" },
    { type: "Info", location: "Gulshan", viewed: 150, clicked: 70, dismissed: 5, sent_at: "2025-07-15" }
  ];

  const feedbackBubble = [
    { label: "Dhanmondi", feedback_positive: 80, feedback_negative: 20, safety_score: 75, traffic_density: 60, submitted_at: "2025-07-17" },
    { label: "Gulshan", feedback_positive: 90, feedback_negative: 10, safety_score: 85, traffic_density: 50, submitted_at: "2025-07-16" }
  ];

  // Render Crime Hotspots Cards
  function renderCrimeHotspots() {
    const container = document.getElementById('crimeHotspotsContainer');
    container.innerHTML = '';
    crimeHotspots.forEach(item => {
      const div = document.createElement('div');
      div.className = 'col-md-3';
      div.innerHTML = `
        <div class="info-box bg-danger">
          <span class="info-box-icon"><i class="fas fa-exclamation-triangle"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">${item.area} (${item.thana})</span>
            <span class="info-box-number">${item.incident_count} Incidents</span>
            <span class="progress-description">Crime Index: ${item.crime_index.toFixed(2)}</span>
          </div>
        </div>
      `;
      container.appendChild(div);
    });
  }

  // Render Safety Distribution Progress Bars
  function renderSafetyDistribution() {
    const container = document.getElementById('safetyDistributionContainer');
    container.innerHTML = '';
    safetyDistribution.forEach(item => {
      const color = item.label === 'Safe' ? 'success' : (item.label === 'Moderate' ? 'warning' : 'danger');
      const div = document.createElement('div');
      div.className = 'col-md-4';
      div.innerHTML = `
        <h5>${item.label} (${item.category})</h5>
        <div class="progress mb-1">
          <div class="progress-bar bg-${color}" style="width: ${item.value}%">
            ${item.value}%
          </div>
        </div>
        <small>Weightage: ${item.weightage_percent}%</small>
      `;
      container.appendChild(div);
    });
  }

  // Render Tables with Data
  function renderTable(tableId, data, columns) {
    const tbody = document.querySelector(`#${tableId} tbody`);
    tbody.innerHTML = '';
    data.forEach(row => {
      const tr = document.createElement('tr');
      columns.forEach(col => {
        let cellValue = row[col];
        if (col === 'status') {
          // Wrap status in badge
          const badgeClass = cellValue === 'Safe' ? 'success' : 'danger';
          cellValue = `<span class="badge badge-${badgeClass}">${cellValue}</span>`;
        }
        if (col === 'average_response_time_min' && typeof cellValue === 'number') {
          cellValue = cellValue.toFixed(2);
        }
        tr.innerHTML += `<td>${cellValue}</td>`;
      });
      tbody.appendChild(tr);
    });
  }

  // Initialize DataTables for all tables
  function initDataTables() {
    const tables = [
      '#safetyChecksTable',
      '#featureUsageTable',
      '#crimeTrendsTable',
      '#emergencyResponseTable',
      '#notificationTable',
      '#feedbackTable'
    ];

    tables.forEach(selector => {
      if ($(selector).length) {
        $(selector).DataTable({
          pageLength: 10,
          lengthChange: false,
          dom: 'Bfrtip',
          buttons: ['copyHtml5', 'csvHtml5', 'excelHtml5', 'pdfHtml5'],
          responsive: true
        });
      }
    });
  }

  $(document).ready(function() {
    renderCrimeHotspots();
    renderSafetyDistribution();

    renderTable('safetyChecksTable', safetyChecks, ['check_day', 'check_time', 'check_type', 'location', 'status']);
    renderTable('featureUsageTable', featureUsage, ['feature', 'usage_count', 'user_type', 'last_used_at']);
    renderTable('crimeTrendsTable', crimeTypeTrends, ['week', 'area', 'theft', 'harassment', 'assault', 'robbery', 'vandalism', 'kidnapping', 'updated_at']);
    renderTable('emergencyResponseTable', emergencyResponse, ['area', 'service_type', 'average_response_time_min', 'response_rating', 'last_reported']);
    renderTable('notificationTable', notificationEngagement, ['type', 'location', 'viewed', 'clicked', 'dismissed', 'sent_at']);
    renderTable('feedbackTable', feedbackBubble, ['label', 'feedback_positive', 'feedback_negative', 'safety_score', 'traffic_density', 'submitted_at']);

    initDataTables();
  });
</script>
</body>
</html>
